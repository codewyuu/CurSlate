"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5424],{34362:(e,t,s)=>{const{V4MAPPED:i,ADDRCONFIG:a,ALL:o,promises:{Resolver:r},lookup:n}=s(85453),{promisify:l}=s(40537),h=s(50011),c=Symbol("cacheableLookupCreateConnection"),f=Symbol("cacheableLookupInstance"),u=Symbol("expires"),_="number"==typeof o,m=e=>{if(!e||"function"!=typeof e.createConnection)throw new Error("Expected an Agent instance as the first argument")},p=()=>{let e=!1,t=!1;for(const s of Object.values(h.networkInterfaces()))for(const i of s)if(!i.internal&&("IPv6"===i.family?t=!0:e=!0,e&&t))return{has4:e,has6:t};return{has4:e,has6:t}},y={ttl:!0},v={all:!0};class k{constructor({cache:e=new Map,maxTtl:t=1/0,fallbackDuration:s=3600,errorTtl:i=.15,resolver:a=new r,lookup:o=n}={}){if(this.maxTtl=t,this.errorTtl=i,this._cache=e,this._resolver=a,this._dnsLookup=l(o),this._resolver instanceof r?(this._resolve4=this._resolver.resolve4.bind(this._resolver),this._resolve6=this._resolver.resolve6.bind(this._resolver)):(this._resolve4=l(this._resolver.resolve4.bind(this._resolver)),this._resolve6=l(this._resolver.resolve6.bind(this._resolver))),this._iface=p(),this._pending={},this._nextRemovalTime=!1,this._hostnamesToFallback=new Set,s<1)this._fallback=!1;else{this._fallback=!0;const e=setInterval((()=>{this._hostnamesToFallback.clear()}),1e3*s);e.unref&&e.unref()}this.lookup=this.lookup.bind(this),this.lookupAsync=this.lookupAsync.bind(this)}set servers(e){this.clear(),this._resolver.setServers(e)}get servers(){return this._resolver.getServers()}lookup(e,t,s){if("function"==typeof t?(s=t,t={}):"number"==typeof t&&(t={family:t}),!s)throw new Error("Callback must be a function.");this.lookupAsync(e,t).then((e=>{t.all?s(null,e):s(null,e.address,e.family,e.expires,e.ttl)}),s)}async lookupAsync(e,t={}){"number"==typeof t&&(t={family:t});let s=await this.query(e);if(6===t.family){const e=s.filter((e=>6===e.family));t.hints&i&&(_&&t.hints&o||0===e.length)?(e=>{for(const t of e)6!==t.family&&(t.address=`::ffff:${t.address}`,t.family=6)})(s):s=e}else 4===t.family&&(s=s.filter((e=>4===e.family)));if(t.hints&a){const{_iface:e}=this;s=s.filter((t=>6===t.family?e.has6:e.has4))}if(0===s.length){const t=new Error(`cacheableLookup ENOTFOUND ${e}`);throw t.code="ENOTFOUND",t.hostname=e,t}return t.all?s:s[0]}async query(e){let t=await this._cache.get(e);if(!t){const s=this._pending[e];if(s)t=await s;else{const s=this.queryAndCache(e);this._pending[e]=s;try{t=await s}finally{delete this._pending[e]}}}return t=t.map((e=>({...e}))),t}async _resolve(e){const[t,s]=await Promise.all([this._resolve4(e,y),this._resolve6(e,y)].map((e=>(async e=>{try{return await e}catch(e){if("ENODATA"===e.code||"ENOTFOUND"===e.code)return[];throw e}})(e))));let i=0,a=0,o=0;const r=Date.now();for(const e of t)e.family=4,e.expires=r+1e3*e.ttl,i=Math.max(i,e.ttl);for(const e of s)e.family=6,e.expires=r+1e3*e.ttl,a=Math.max(a,e.ttl);return o=t.length>0?s.length>0?Math.min(i,a):i:a,{entries:[...t,...s],cacheTtl:o}}async _lookup(e){try{return{entries:await this._dnsLookup(e,{all:!0}),cacheTtl:0}}catch(e){return{entries:[],cacheTtl:0}}}async _set(e,t,s){if(this.maxTtl>0&&s>0){s=1e3*Math.min(s,this.maxTtl),t[u]=Date.now()+s;try{await this._cache.set(e,t,s)}catch(e){this.lookupAsync=async()=>{const t=new Error("Cache Error. Please recreate the CacheableLookup instance.");throw t.cause=e,t}}i=this._cache,Symbol.iterator in i&&this._tick(s)}var i}async queryAndCache(e){if(this._hostnamesToFallback.has(e))return this._dnsLookup(e,v);let t=await this._resolve(e);0===t.entries.length&&this._fallback&&(t=await this._lookup(e),0!==t.entries.length&&this._hostnamesToFallback.add(e));const s=0===t.entries.length?this.errorTtl:t.cacheTtl;return await this._set(e,t.entries,s),t.entries}_tick(e){const t=this._nextRemovalTime;(!t||e<t)&&(clearTimeout(this._removalTimeout),this._nextRemovalTime=e,this._removalTimeout=setTimeout((()=>{this._nextRemovalTime=!1;let e=1/0;const t=Date.now();for(const[s,i]of this._cache){const a=i[u];t>=a?this._cache.delete(s):a<e&&(e=a)}e!==1/0&&this._tick(e-t)}),e),this._removalTimeout.unref&&this._removalTimeout.unref())}install(e){if(m(e),c in e)throw new Error("CacheableLookup has been already installed");e[c]=e.createConnection,e[f]=this,e.createConnection=(t,s)=>("lookup"in t||(t.lookup=this.lookup),e[c](t,s))}uninstall(e){if(m(e),e[c]){if(e[f]!==this)throw new Error("The agent is not owned by this CacheableLookup instance");e.createConnection=e[c],delete e[c],delete e[f]}}updateInterfaceInfo(){const{_iface:e}=this;this._iface=p(),(e.has4&&!this._iface.has4||e.has6&&!this._iface.has6)&&this._cache.clear()}clear(e){e?this._cache.delete(e):this._cache.clear()}}e.exports=k,e.exports.default=k}}]);